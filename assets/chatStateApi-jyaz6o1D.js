import{s as o}from"./index-CUHM3XYC.js";const n={async getByUser(t){try{const{data:e,error:r}=await o.from("chat_states").select("*").eq("user_email",t).order("created_at",{ascending:!1});if(r)throw r;return e||[]}catch(e){return console.error("Error fetching chat states:",e),[]}},async getActiveStates(t){try{const e=new Date().toISOString(),{data:r,error:a}=await o.from("chat_states").select("*").eq("user_email",t).gt("expires_at",e).order("created_at",{ascending:!1});if(a)throw a;return r||[]}catch(e){return console.error("Error fetching active chat states:",e),[]}},async getByType(t,e){try{const r=new Date().toISOString(),{data:a,error:s}=await o.from("chat_states").select("*").eq("user_email",t).eq("state_type",e).gt("expires_at",r).order("created_at",{ascending:!1}).limit(1).single();if(s&&s.code!=="PGRST116")throw s;return a||null}catch(r){return console.error("Error fetching chat state by type:",r),null}},async create(t){try{const{data:e,error:r}=await o.from("chat_states").insert([t]).select().single();if(r)throw r;return e}catch(e){throw console.error("Error creating chat state:",e),e}},async update(t,e){try{const{data:r,error:a}=await o.from("chat_states").update(e).eq("id",t).select().single();if(a)throw a;return r}catch(r){throw console.error("Error updating chat state:",r),r}},async delete(t){try{const{error:e}=await o.from("chat_states").delete().eq("id",t);if(e)throw e;return!0}catch(e){throw console.error("Error deleting chat state:",e),e}},async deleteExpired(){try{const t=new Date().toISOString(),{error:e}=await o.from("chat_states").delete().lt("expires_at",t);if(e)throw e;return!0}catch(t){throw console.error("Error deleting expired chat states:",t),t}},async deleteByUser(t){try{const{error:e}=await o.from("chat_states").delete().eq("user_email",t);if(e)throw e;return!0}catch(e){throw console.error("Error deleting chat states by user:",e),e}},async filter(t={}){try{let e=o.from("chat_states").select("*");t.user_email&&(e=e.eq("user_email",t.user_email)),t.state_type&&(e=e.eq("state_type",t.state_type)),t.expires_at&&(typeof t.expires_at=="object"&&t.expires_at.$gt?e=e.gt("expires_at",t.expires_at.$gt):e=e.eq("expires_at",t.expires_at)),e=e.order("created_at",{ascending:!1});const{data:r,error:a}=await e;if(a)throw a;return r||[]}catch(e){return console.error("Error filtering chat states:",e),[]}}};export{n as chatStateApi};
